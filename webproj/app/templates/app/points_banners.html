{% extends "./base.html" %}
{% load static %}

{% block title %}Hogwarts House Banners{% endblock %}

{% block content %}
<style>
    .banner {
        animation: fall 1s ease-out;
        width: 220px;
        height: 450px;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 20px;
        font-family: 'MedievalSharp', cursive; /* Using a medieval-style font */
        border: 2px solid #000;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
    }

    .banner::after {
        content: '';
        position: absolute;
        bottom: 10px;
        left: 50%;
        width: 0;
        height: 0;
        border-left: 90px solid transparent;
        border-right: 90px solid transparent;
        border-top: 60px solid currentColor;
        transform: translateX(-50%);
    }

    @keyframes fall {
        0% {
            transform: translateY(-10%);
            opacity: 0;
        }
        100% {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* House colors */
    .gryffindor {
        background-color: #670100; /* Scarlet */
        color: #E19C08; /* Gold */
    }

    .hufflepuff {
        background-color: #FF9C0A; /* Yellow */
        color: #1F1E19; /* Black */
    }

    .ravenclaw {
        background-color: #1A3956; /* Blue */
        color: #8F511D; /* Bronze */
    }

    .slytherin {
        background-color: #2E741C; /* Green */
        color: #CDCCCD; /* Silver */
    }
    .dashboard-card, .dashboard-main-card {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
    }
    .dashboard-card:hover {
        background-color: rgba(255, 255, 255, 0.6);
    }
    .table-cell-custom {
        @apply truncate max-w-xs; /* Truncate text and set max width */
    }
    .charts-container {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    .chart-container {
        flex-basis: 50%; /* Adjust based on the desired width, ensuring both have the same width */
        height: 400px; /* Define a fixed height or use aspect-ratio property */
    }
</style>

<h2 class="text-4xl font-bold text-center mt-10">Hogwarts House Banners</h2>

<div class="mt-10 flex flex-col items-center justify-center">
    <div class="container mx-auto px-6 rounded-lg">
        <div class="dashboard-main-card shadow-xl rounded-lg p-6 mb-10">
            <div class="mt-10 flex flex-row justify-center items-center ">
                <!-- Gryffindor -->
                <div about="{{ houses.Gryffindor.id }}" typeof="hogwarts:House" class="banner gryffindor text-center py-8 shadow-lg h-card">
                    <h3 property="hogwarts:hasHouseName p-name" class="text-3xl font-bold">Gryffindor</h3>
                    <p property="hogwarts:hasTotalPoints p-category" class="text-6xl font-bold mt-4">{{ houses.Gryffindor.totalPoints }}</p>
                </div>

                <!-- Hufflepuff -->
                <div about="{{ houses.Hufflepuff.id }}" typeof="hogwarts:House" class="banner hufflepuff text-center py-8 shadow-lg h-card">
                    <h3 property="hogwarts:hasHouseName p-name" class="text-3xl font-bold">Hufflepuff</h3>
                    <p property="hogwarts:hasTotalPoints p-category" class="text-6xl font-bold mt-4">{{ houses.Hufflepuff.totalPoints }}</p>
                </div>

                <!-- Ravenclaw -->
                <div about="{{ houses.Ravenclaw.id }}" typeof="hogwarts:House" class="banner ravenclaw text-center py-8 shadow-lg h-card">
                    <h3 property="hogwarts:hasHouseName p-name" class="text-3xl font-bold">Ravenclaw</h3>
                    <p property="hogwarts:hasTotalPoints p-category" class="text-6xl font-bold mt-4">{{ houses.Ravenclaw.totalPoints }}</p>
                </div>

                <!-- Slytherin -->
                <div about="{{ houses.Slytherin.id }}" typeof="hogwarts:House" class="banner slytherin text-center py-8 shadow-lg h-card">
                    <h3 property="hogwarts:hasHouseName p-name" class="text-3xl font-bold">Slytherin</h3>
                    <p property="hogwarts:hasTotalPoints p-category" class="text-6xl font-bold mt-4">{{ houses.Slytherin.totalPoints }}</p>
                </div>
            </div>

            <div class="mt-10 flex flex-col items-center justify-center overflow-x-auto">
                <div class="container mx-auto">
                    <div class="dashboard-main-card shadow rounded-lg p-4 mb-8 overflow-hidden">
                        <h3 class="text-2xl font-semibold mb-3 leading-tight">Students</h3>
                        <div class="flex flex-row space-x-4">
                            <!-- Table 1 -->
                            <div about="{{houses.Gryffindor.id}}" typeof="hogwarts:House" class="w-1/4 flex-1 rounded-lg overflow-hidden">
                                <table class="min-w-full leading-normal table-fixed">
                                    <thead>
                                        <tr>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                ★
                                            </th>
                                            <th class="w-1/4 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Name
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-center text-xs font-semibold text-white uppercase tracking-wider">
                                                Points
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Type
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentsTableBody1" class="bg-white"></tbody>
                                </table>
                            </div>
                            <!-- Table 2 -->
                            <div about="{{houses.Hufflepuff.id}}" typeof="hogwarts:House" class="w-1/4 flex-1 rounded-lg overflow-hidden">
                                <table class="min-w-full leading-normal table-fixed">
                                    <thead>
                                        <tr>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                ★
                                            </th>
                                            <th class="w-1/4 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Name
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-center text-xs font-semibold text-white uppercase tracking-wider">
                                                Points
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Type
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentsTableBody2" class="bg-white" style="height: 100%"></tbody>
                                </table>
                            </div>
                            <!-- Table 3 -->
                            <div about="{{houses.Ravenclaw.id}}" typeof="hogwarts:House" class="w-1/4 flex-1 rounded-lg overflow-hidden">
                                <table class="min-w-full leading-normal table-fixed">
                                    <thead>
                                        <tr>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                ★
                                            </th>
                                            <th class="w-1/4 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Name
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-center text-xs font-semibold text-white uppercase tracking-wider">
                                                Points
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Type
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentsTableBody3" class="bg-white" style="height: 100%"></tbody>
                                </table>
                            </div>
                            <!-- Table 4 -->
                            <div about="{{houses.Slytherin.id}}" typeof="hogwarts:House" class="w-1/4 flex-1 rounded-lg overflow-hidden">
                                <table class="min-w-full leading-normal table-fixed">
                                    <thead>
                                        <tr>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                ★
                                            </th>
                                            <th class="w-1/4 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Name
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-center text-xs font-semibold text-white uppercase tracking-wider">
                                                Points
                                            </th>
                                            <th class="w-1/5 px-5 py-3 border-b-2 border-gray-200 bg-amber-600 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                                Type
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentsTableBody4" class="bg-white" style="height: 100%"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="pagination mt-4 text-amber-600 flex justify-center items-center gap-4">
                            <button onclick="changeStudentsPage(-1)" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded">Prev</button>
                            <span id="studentPageIndicator" class="font-semibold">Page 1</span>
                            <button onclick="changeStudentsPage(1)" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const students = {{ students|safe }}; 

    var currentStudentPage = 1;
    var studentsPerPage = 5;

    var house_mapping = {
        "Gryffindor": [],
        "Hufflepuff": [],
        "Ravenclaw": [],
        "Slytherin": []
    };

    students.forEach(student => {
        house_mapping[student.house_name].push(student);
    });
    
    function renderStudents() {

        function renderHouseStudents(house, paginatedStudents, mapping) {
            var container = mapping[house];
            container.innerHTML = '';
            paginatedStudents.forEach(student => {
                var points = student.points ? student.points : 'Unknown';
                var stars_mapping = {
                    1: '⭐',
                    2: '⭐⭐',
                    3: '⭐\n⭐⭐',
                    4: '⭐⭐\n⭐⭐',
                    5: '⭐⭐\n⭐⭐⭐'
                };
                var stars = stars_mapping[student.star] || 1;
                var type_mapping = {
                    'basic_student': 'B',
                    'medium_student': 'M',
                    'advanced_student': 'A'
                };
                student_type = type_mapping[student.student_type] || 'M';
                var row = `
                        <tr class="h-card" rel="hogwarts:includesWizard" typeof="hogwarts:Wizard" resource="${student.id}">
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center">
                                <div typeof="hogwarts:Student" resource="${student.student_id}" rel="hogwarts:isAccountOf">
                                    <span class="p-rating" property="hogwarts:hasStarRating" content="${student.star}">${stars}</span>
                                </div>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <p class="p-name" property="hogwarts:hasName" class="text-gray-900 whitespace-no-wrap">${student.name}</p>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center">
                                <div property="hogwarts:hasTotalPoints" content="${points}">
                                    ${points}
                                </div>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-left font-bold">
                                <div property="hogwarts:hasStudentType" content="${student_type}">
                                    ${student_type}
                                </div>
                            </td>
                        </tr>`;
                container.innerHTML += row;
            });
            // Set the height of the table dynamically
            var tableHeight = container.getBoundingClientRect().height;
            container.parentElement.style.height = tableHeight + 'px';
        };

        var container1 = document.getElementById('studentsTableBody1');
        var container2 = document.getElementById('studentsTableBody2');
        var container3 = document.getElementById('studentsTableBody3');
        var container4 = document.getElementById('studentsTableBody4');
        var mapping = {
            "Gryffindor": container1,
            "Hufflepuff": container2,
            "Ravenclaw": container3,
            "Slytherin": container4
        };
        container1.innerHTML = '';
        container2.innerHTML = '';
        container3.innerHTML = '';
        container4.innerHTML = '';

        var start = (currentStudentPage - 1) * studentsPerPage;
        var end = start + studentsPerPage;

        renderHouseStudents("Gryffindor", house_mapping["Gryffindor"].slice(start, end), mapping);
        renderHouseStudents("Hufflepuff", house_mapping["Hufflepuff"].slice(start, end), mapping);
        renderHouseStudents("Ravenclaw", house_mapping["Ravenclaw"].slice(start, end), mapping);
        renderHouseStudents("Slytherin", house_mapping["Slytherin"].slice(start, end), mapping);
        
        document.getElementById('studentPageIndicator').innerText = `Page ${currentStudentPage}`;
    }
    
    function changeStudentsPage(step) {
        var totalPages = Math.ceil(students.length / studentsPerPage);
        currentStudentPage += step;
        if (currentStudentPage < 1) currentStudentPage = 1;
        else if (currentStudentPage > totalPages) currentStudentPage = totalPages;
    
        renderStudents();
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        renderStudents();
    });
</script>

{% endblock %}
